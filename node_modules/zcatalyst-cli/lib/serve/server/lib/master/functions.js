"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addFnRoutes = void 0;
const constants_1 = require("../../../../util_modules/constants");
function addFnRoutes(app, details, proxy) {
    if (details.isAlive === false) {
        return;
    }
    const fnTarget = details.target;
    app.use(`/server/${fnTarget.name}`, (req, res) => {
        var _a;
        if (!((_a = details.target) === null || _a === void 0 ? void 0 : _a.valid)) {
            res.status(503);
            res.write(JSON.stringify({ data: 'Error connecting with the function' }));
            return;
        }
        proxy.web(req, res, {
            target: `http://127.0.0.1:${details.httpPort}${fnTarget.type === constants_1.FN_TYPE.basic ? `/server/${fnTarget.name}/execute` : ''}`,
            ws: true
        });
    });
    app.use(`/baas/v1/project/:projectId/function/${fnTarget.name}`, (req, res) => {
        var _a;
        if (!((_a = details.target) === null || _a === void 0 ? void 0 : _a.valid)) {
            res.status(503);
            res.write(JSON.stringify({ data: 'Error connecting with the function' }));
            return;
        }
        proxy.web(req, res, {
            target: `http://127.0.0.1:${details.httpPort}${fnTarget.type === constants_1.FN_TYPE.basic ? `/server/${fnTarget.name}/execute` : ''}`,
            ws: true
        });
    });
    if (fnTarget.id) {
        app.use(`/server/${fnTarget.id}`, (req, res) => {
            var _a;
            if (!((_a = details.target) === null || _a === void 0 ? void 0 : _a.valid)) {
                res.status(503);
                res.write(JSON.stringify({ data: 'Error connecting with the function' }));
                return;
            }
            proxy.web(req, res, {
                target: `http://127.0.0.1:${details.httpPort}${fnTarget.type === constants_1.FN_TYPE.basic ? `/server/${fnTarget.id}/execute` : ''}`,
                ws: true
            });
        });
        app.use(`/baas/v1/project/:projectId/function/${fnTarget.id}`, (req, res) => {
            var _a;
            if (!((_a = details.target) === null || _a === void 0 ? void 0 : _a.valid)) {
                res.status(503);
                res.write(JSON.stringify({ data: 'Error connecting with the function' }));
                return;
            }
            proxy.web(req, res, {
                target: `http://127.0.0.1:${details.httpPort}${fnTarget.type === constants_1.FN_TYPE.basic ? `/server/${fnTarget.id}/execute` : ''}`,
                ws: true
            });
        });
    }
}
exports.addFnRoutes = addFnRoutes;
